<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.2//EN" "http://www.w3.org/Graphics/SVG/1.2/DTD/svg12.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="full" xml:space="preserve" width="600" height="580">
<desc>Source file</desc>
<defs><style type="text/css">
<![CDATA[
rect { fill:#ffffff; } 
g { font-size: 10pt; font-family: Courier New; white-space: pre; }
]]>
</style></defs><g>
<rect x="0" y="0" width="100%" height="100%"/>
<text x="10" y="20"></text>
<text x="10" y="20"><tspan style="font-weight:bold;fill:#7f7f7f;">diff&#160;--git&#160;a/day_03_part_1.sql&#160;b/day_03_part_2.sql</tspan>
</text>
<text x="10" y="40"><tspan style="font-weight:bold;fill:#7f7f7f;">index&#160;1b84d39..326ed9f&#160;100644</tspan>
</text>
<text x="10" y="60"><tspan style="font-weight:bold;fill:#7f7f7f;">---&#160;a/day_03_part_1.sql</tspan>
</text>
<text x="10" y="80"><tspan style="font-weight:bold;fill:#7f7f7f;">+++&#160;b/day_03_part_2.sql</tspan>
</text>
<text x="10" y="100"><tspan style="fill:#00cdcd;">@@&#160;-12,10&#160;+12,23&#160;@@</tspan>&#160;VACUUM&#160;ANALYZE&#160;day03.inputs;
</text>
<text x="10" y="120">
</text>
<text x="10" y="140">\timing&#160;on
</text>
<text x="10" y="160">
</text>
<text x="10" y="180"><tspan style="fill:#00cd00;">WITH&#160;RECURSIVE&#160;slopes&#160;AS&#160;(</tspan>
</text>
<text x="10" y="200">&#160;&#160;SELECT&#160;<tspan style="fill:#cd0000;">concat('Day&#160;03&#160;-&#160;Part&#160;1:&#160;',&#160;count(*))</tspan><tspan style="fill:#00cd00;">slope.right,</tspan>
</text>
<text x="10" y="220"><tspan style="fill:#00cd00;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;slope.down,</tspan>
</text>
<text x="10" y="240"><tspan style="fill:#00cd00;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;count(*)&#160;AS&#160;hits</tspan>
</text>
<text x="10" y="260">&#160;&#160;FROM&#160;day03.inputs&#160;i,
</text>
<text x="10" y="280">&#160;&#160;<tspan style="fill:#00cd00;">(VALUES&#160;(1,&#160;1),&#160;(3,&#160;1),&#160;(5,&#160;1),&#160;(7,&#160;1),&#160;(1,&#160;2))&#160;AS&#160;slope&#160;(&quot;right&quot;,&#160;down),</tspan>
</text>
<text x="10" y="300">&#160;&#160;LATERAL&#160;(SELECT&#160;char_length(i.line_value)::int&#160;AS&#160;&quot;length&quot;,
</text>
<text x="10" y="320">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_to_array(i.line_value,&#160;null)&#160;AS&#160;chars)&#160;AS&#160;line,
</text>
<text x="10" y="340">&#160;&#160;LATERAL&#160;(SELECT&#160;<tspan style="fill:#cd0000;">((((i.line_number</tspan><tspan style="fill:#00cd00;">(((((i.line_number</tspan>&#160;-&#160;1)&#160;*&#160;<tspan style="fill:#cd0000;">3)</tspan><tspan style="fill:#00cd00;">slope.right)&#160;/&#160;slope.down)</tspan>&#160;%&#160;line.&quot;length&quot;)&#160;+&#160;1)::int&#160;AS&#160;pos)&#160;AS&#160;toboggan
</text>
<text x="10" y="360">&#160;&#160;WHERE&#160;line.chars[toboggan.pos]&#160;=&#160;'#'
</text>
<text x="10" y="380">&#160;&#160;<tspan style="fill:#00cd00;">AND&#160;(i.line_number&#160;-&#160;1)&#160;%&#160;slope.down&#160;=&#160;0</tspan>
</text>
<text x="10" y="400"><tspan style="fill:#00cd00;">&#160;&#160;GROUP&#160;BY&#160;slope.right,&#160;slope.down</tspan>
</text>
<text x="10" y="420"><tspan style="fill:#00cd00;">),&#160;product(hits,&#160;res)&#160;AS&#160;(</tspan>
</text>
<text x="10" y="440"><tspan style="fill:#00cd00;">&#160;&#160;SELECT&#160;min(hits),&#160;min(hits)&#160;FROM&#160;slopes</tspan>
</text>
<text x="10" y="460"><tspan style="fill:#00cd00;">&#160;&#160;UNION</tspan>
</text>
<text x="10" y="480"><tspan style="fill:#00cd00;">&#160;&#160;SELECT&#160;slopes.hits,&#160;slopes.hits&#160;*&#160;product.res</tspan>
</text>
<text x="10" y="500"><tspan style="fill:#00cd00;">&#160;&#160;FROM&#160;product,</tspan>
</text>
<text x="10" y="520"><tspan style="fill:#00cd00;">&#160;&#160;LATERAL&#160;(SELECT&#160;*&#160;FROM&#160;slopes&#160;WHERE&#160;slopes.hits&#160;&gt;&#160;product.hits&#160;ORDER&#160;BY&#160;slopes.hits&#160;LIMIT&#160;1)&#160;slopes</tspan>
</text>
<text x="10" y="540"><tspan style="fill:#00cd00;">)&#160;SELECT&#160;concat('Day&#160;03&#160;-&#160;Part&#160;2:&#160;',&#160;max(res))&#160;FROM&#160;product</tspan>
</text>
<text x="10" y="560">;
</text>
</g>
</svg>
<!-- SVG generated by ansifilter 2.15, http://www.andre-simon.de/ -->
